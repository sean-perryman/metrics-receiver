{% extends "base.html" %}
{% block content %}
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-semibold">Admin Â· Endpoints</h1>
    <div class="flex gap-3">
      <a class="text-sm text-indigo-600 hover:underline" href="/admin/users">Users</a>
      <a class="text-sm text-indigo-600 hover:underline" href="/admin/settings">Settings</a>
    </div>
  </div>

  {% if new_token %}
    <div class="mb-6 border border-amber-200 bg-amber-50 rounded-xl p-4">
      <div class="font-semibold">New endpoint token (shown once)</div>
      <div class="font-mono text-sm mt-1 break-all">{{ new_token }}</div>
      <div class="text-xs text-slate-600 mt-2">Download a starter config from the endpoint row below, or copy this token into your agent config.</div>
    </div>
  {% endif %}

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
    <div class="bg-white rounded-xl border border-slate-200 p-4 lg:col-span-1">
      <div class="font-semibold mb-2">Create Endpoint</div>
      <form method="post" action="/admin/endpoints/new" class="space-y-2">
        <input class="w-full border rounded px-3 py-2" name="hostname" placeholder="hostname" required />
        <input class="w-full border rounded px-3 py-2" name="machine_id" placeholder="machine_id" required />
        <button class="w-full px-4 py-2 rounded bg-indigo-600 text-white">Create</button>
      </form>
      <div class="text-xs text-slate-500 mt-2">Tip: machine_id should match your agent's stable identifier.</div>
    </div>

    <div class="bg-white rounded-xl border border-slate-200 p-4 lg:col-span-2">
      <div class="font-semibold mb-2">Endpoints</div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-slate-600">
            <tr>
              <th class="text-left py-2">Host</th>
              <th class="text-left py-2">Machine ID</th>
              <th class="text-left py-2">Last seen</th>
              <th class="text-right py-2">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for ep in endpoints %}
              <tr class="border-t">
                <td class="py-2">
                  <a class="text-indigo-600 hover:underline font-medium" href="/hosts/{{ ep.id }}">{{ ep.hostname }}</a>
                  {% if not ep.is_active %}<span class="text-xs text-rose-600">(disabled)</span>{% endif %}
                </td>
                <td class="py-2 font-mono text-xs">{{ ep.machine_id }}</td>
                <td class="py-2 text-xs text-slate-600">{{ ep.last_seen if ep.last_seen else "never" }}</td>
                <td class="py-2 text-right">
                  <a class="text-sm text-indigo-600 hover:underline" href="/admin/endpoints/{{ ep.id }}/config">Download config</a>
                </td>
              </tr>
            {% else %}
              <tr class="border-t"><td class="py-3 text-slate-500" colspan="4">No endpoints yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
